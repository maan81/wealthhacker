<?php

//==============================================================================
// Includes

   require('config/config.php');
   require('include/db.php');

//==============================================================================



//==============================================================================
// Init

   // init db access
   $db = new Database($config['db']);

//==============================================================================



//==============================================================================
// Validate & sanitaze variable
  
	$q = filter_var(
	              $_GET['q'], 
	              FILTER_VALIDATE_REGEXP,
	              array("options"=>array("regexp"=>"/^[a-zA-Z]{1,6}$/"))
	            );

	if(!$q){
		return;
	}

//==============================================================================



//==============================================================================
// Get stocks list

   // where
   $sql = ' AND symbol LIKE "'.$q.'%" ';

   // order by
   $sql .= ' ORDER BY count DESC , symbol ASC';

   //limit
   $sql .= ' LIMIT 10 ';

   $view_data['queries'] = $db->get($config['db']['table_queries'],$sql);
   // _print_r($db->sql,false);
   // _print_r($view_data);   

//==============================================================================



//==============================================================================
// Return format as json

   echo json_encode($view_data['queries']);

//==============================================================================
